# 📚 文档体系使用指南

> **目标**：让程序员快速找到需要的信息，让AI快速定位技术细节，让操作者有清晰的执行步骤

---

## 🏗️ 文档分层架构

本项目采用 **三层金字塔文档架构**，解决传统文档"细节过多、难以消化"的问题：

```
                    ┌─────────────┐
                    │  心法 Heart │  ← 程序员读（脉络）
                    │  100-200行  │
                    └──────┬──────┘
                           │
              ┌────────────┴────────────┐
              │      大脑 Brain         │  ← AI读（细节）
              │      500-1000行         │
              └────────────┬────────────┘
                           │
         ┌─────────────────┴─────────────────┐
         │           手册 Hands              │  ← 操作者读（步骤）
         │           200-500行               │
         └───────────────────────────────────┘
```

---

## 📖 三层详解

### 第一层：心法（Heart）- 给程序员看

**位置**：
- `PRD-完整版.md` - 产品需求文档
- `README.md` - 各模块导航中心

**内容**：
- 产品功能概览
- 系统架构全貌
- 模块关系图
- 快速导航链接

**特点**：
- ✅ 简洁：100-200行，只描述"是什么"
- ✅ 重脉络：让人快速理解系统全貌
- ✅ 轻细节：不包含具体实现代码
- ✅ 多链接：通过链接引导到详细文档

**适用场景**：
- 新成员加入团队
- 快速了解项目结构
- 产品功能回顾

**示例**：
```markdown
## 配额管理模块

### 功能概述
限制用户的文章分析次数和字数，支持免费和付费两种订阅等级。

### 核心能力
- 每日分析次数限制
- 单篇文章字数限制
- 实时配额查询
- 超限友好提示

### 技术实现
详见 [配额系统技术文档](tech/quota-system.md)

### 操作指南
详见 [配额测试指南](ops/quota-testing.md)
```

---

### 第二层：大脑（Brain）- 给AI看

**位置**：
- `tech/` 目录下的所有文档

**内容**：
- 系统架构设计
- 数据库表结构
- API接口规范
- 技术实现细节
- 核心代码示例

**特点**：
- ✅ 详细：500-1000行，完整描述技术实现
- ✅ 重"如何"：聚焦具体实现方式
- ✅ 轻"为何"：不过多解释设计决策原因
- ✅ 代码优先：大量代码示例和类型定义

**适用场景**：
- AI需要理解系统实现
- AI需要修改或扩展功能
- AI需要定位具体代码位置

**示例**：
```markdown
## 配额检查中间件实现

### 中间件位置
`projects/api/src/middleware/quota-check.middleware.ts`

### 核心逻辑

#### 1. 获取用户订阅信息
...数据库查询代码...

#### 2. 检查每日分析次数
...检查逻辑代码...

#### 3. 检查文章字数限制
...字数校验代码...

### 数据库查询
...具体SQL/ORM代码...

### 错误处理
...错误码和响应格式...
```

---

### 第三层：手册（Hands）- 给操作者看

**位置**：
- `ops/` 目录下的所有文档

**内容**：
- 部署步骤清单
- 配置文件说明
- 测试用例步骤
- 故障排查指南
- 环境变量说明

**特点**：
- ✅ 清单式：200-500行，每步都可执行
- ✅ 重步骤：按顺序执行即可完成任务
- ✅ 可复制：命令可直接复制运行
- ✅ 场景化：针对具体操作场景编写

**适用场景**：
- 部署系统到生产环境
- 配置开发环境
- 执行测试用例
- 解决常见问题

**示例**：
```markdown
## 配额系统测试指南

### 前置条件
- [ ] 数据库已初始化
- [ ] API服务已启动
- [ ] 有测试用户账号

### 测试步骤

#### 测试1：查询配额信息
```bash
curl http://localhost:8787/api/quota/info
```

预期结果：
```json
{
  "tier": "free",
  "dailyAnalysisLimit": 2,
  ...
}
```

#### 测试2：超限检查
...具体步骤...
```

---

## 📂 目录结构

```
vocab-master/
├── DOCUMENTATION_GUIDE.md          # 本文档（使用指南）
├── projects/
│   ├── api/docs/                   # 后端文档
│   │   ├── README.md               # 后端导航中心（心法层）
│   │   ├── PRD-完整版.md           # 产品需求文档（心法层）
│   │   ├── tech/                   # 技术文档（大脑层）
│   │   │   ├── architecture.md     # 系统架构
│   │   │   ├── auth-system.md      # 认证系统
│   │   │   ├── quota-system.md     # 配额系统
│   │   │   ├── stripe-integration.md  # Stripe集成
│   │   │   ├── database-guide.md   # 数据库指南
│   │   │   ├── email-system.md     # 邮件系统
│   │   │   └── bindings-types.md   # 环境变量类型
│   │   └── ops/                    # 操作文档（手册层）
│   │       ├── deployment.md       # 部署指南
│   │       ├── config-guide.md     # 配置说明
│   │       ├── quota-testing.md    # 配额测试
│   │       └── stripe-setup.md     # Stripe设置
│   └── client/docs/                # 前端文档
│       ├── README.md               # 前端导航中心（心法层）
│       ├── tech/                   # 技术文档（大脑层）
│       │   ├── auth-client.md      # 客户端认证
│       │   └── theme-system.md     # 主题系统
│       └── ops/                    # 操作文档（手册层）
│           ├── session-guide.md    # Session使用指南
│           ├── theme-usage.md      # 主题使用指南
│           ├── dev-setup.md        # 开发环境配置
│           └── feature-logs.md     # 功能实现记录
```

---

## ✍️ 文档编写规范

### 新增功能时的文档流程

```
1. 更新 PRD-完整版.md
   └─ 在对应模块添加功能简介（3-5行）
   
2. 创建 tech/ 技术文档
   └─ 详细描述架构、数据结构、API规范
   
3. 创建 ops/ 操作文档
   └─ 编写部署步骤、测试用例、配置说明
   
4. 更新 README.md
   └─ 添加导航链接到新文档
```

### 各层文档的编写要求

#### 心法层（PRD、README）

**长度控制**：100-200行/模块

**编写要点**：
- 只回答"是什么"，不回答"怎么做"
- 使用列表、图表、简短段落
- 每个功能点 3-5 行说明即可
- 通过链接引导到详细文档

**示例模板**：
```markdown
## 功能模块名称

### 功能概述
简短描述功能价值（1-2句话）

### 核心能力
- 能力1
- 能力2
- 能力3

### 相关文档
- 技术实现：[链接到tech/]
- 操作指南：[链接到ops/]
```

---

#### 大脑层（tech/）

**长度控制**：500-1000行/文档

**编写要点**：
- 聚焦"如何实现"，省略"为何这样设计"
- 大量代码示例和类型定义
- 包含完整的数据库表结构
- 包含完整的API请求/响应格式
- 使用代码块，不要用文字描述代码

**示例模板**：
```markdown
## 功能技术文档

### 系统架构
[架构图或文字描述]

### 数据库设计
```typescript
export const tableName = pgTable("table_name", {
  // 完整字段定义
});
```

### API接口

#### 接口1：GET /api/xxx
**请求参数**：
```typescript
// 类型定义
```

**响应格式**：
```typescript
// 类型定义
```

**实现位置**：
`projects/api/src/xxx.ts`

**核心逻辑**：
```typescript
// 关键代码片段
```

### 错误处理
| 错误码 | 说明 | 处理方式 |
|--------|------|----------|
```

---

#### 手册层（ops/）

**长度控制**：200-500行/文档

**编写要点**：
- 清单式步骤，每步可执行
- 命令可直接复制运行
- 包含预期结果和常见错误
- 按操作场景组织（部署、测试、配置等）

**示例模板**：
```markdown
## 操作指南

### 前置条件
- [ ] 条件1
- [ ] 条件2

### 步骤1：准备环境

#### 1.1 安装依赖
```bash
npm install
```

**预期输出**：
```
added 123 packages
```

**常见错误**：
- 错误1：解决方法
- 错误2：解决方法

### 步骤2：配置文件
...

### 验证结果
- [ ] 验证点1
- [ ] 验证点2
```

---

## 🔄 文档维护原则

### 定期检查清单

**每月检查**（由项目维护者执行）：
- [ ] 检查是否有过时的技术实现描述
- [ ] 检查是否有失效的链接
- [ ] 检查是否有重复内容可以合并
- [ ] 检查新增功能是否有对应文档

**每次发布前**：
- [ ] 更新 PRD 中的版本号和功能列表
- [ ] 更新部署文档中的配置说明
- [ ] 更新环境变量文档

### 文档重构信号

出现以下情况时，需要重构文档：

**信号1：单个文档超过 1500 行**
→ 拆分为多个子文档

**信号2：同一内容在多处重复**
→ 提取为独立文档，其他地方引用链接

**信号3：文档难以找到需要的信息**
→ 重新组织结构，改进导航

**信号4：文档与代码实现不一致**
→ 更新文档或标记为过时

---

## 🎯 使用场景速查

### 我是新加入的程序员

**目标**：快速了解项目

**路径**：
1. 阅读 `PRD-完整版.md`（20分钟）
2. 阅读 `projects/api/docs/README.md`（5分钟）
3. 阅读 `projects/client/docs/README.md`（5分钟）
4. 根据需要深入 `tech/` 或 `ops/` 目录

**时间**：30分钟完成概览

---

### 我是AI，需要修改某个功能

**目标**：定位技术细节

**路径**：
1. 在 `README.md` 找到功能模块
2. 点击链接进入 `tech/` 对应文档
3. 查找数据库表、API接口、实现位置
4. 直接修改代码

**时间**：1分钟定位

---

### 我需要部署系统

**目标**：按步骤执行

**路径**：
1. 打开 `ops/deployment.md`
2. 按清单逐项执行
3. 遇到问题查看"常见错误"

**时间**：根据文档步骤

---

### 我需要测试某个功能

**目标**：执行测试用例

**路径**：
1. 在 `README.md` 找到功能模块
2. 点击"操作指南"链接进入 `ops/`
3. 按测试步骤执行

**时间**：根据测试步骤

---

## 📝 文档命名规范

### 文件命名

**心法层**：
- `README.md` - 导航中心
- `PRD-完整版.md` - 产品需求文档

**大脑层（tech/）**：
- `xxx-system.md` - 系统级文档（如 `auth-system.md`）
- `xxx-integration.md` - 集成文档（如 `stripe-integration.md`）
- `xxx-guide.md` - 指南文档（如 `database-guide.md`）

**手册层（ops/）**：
- `xxx-setup.md` - 设置文档（如 `stripe-setup.md`）
- `xxx-testing.md` - 测试文档（如 `quota-testing.md`）
- `xxx-guide.md` - 指南文档（如 `config-guide.md`）
- `deployment.md` - 部署文档（固定名称）

### 标题层级

**所有文档统一使用**：
```markdown
# 一级标题（文档标题，仅1个）
## 二级标题（主要章节）
### 三级标题（子章节）
#### 四级标题（具体内容）
```

---

## 🚫 反模式（避免这样做）

### ❌ 反模式1：在PRD中写实现细节

**错误示例**：
```markdown
## 配额管理模块

配额检查通过中间件实现，在 quota-check.middleware.ts 中：
1. 首先查询 subscriptions 表获取用户订阅信息
2. 然后查询 quota_configs 表获取配额配置
3. 接着查询 userLearningStats 表统计今日分析次数
4. 最后比较...（省略500行代码细节）
```

**正确做法**：
```markdown
## 配额管理模块

限制用户的文章分析次数和字数，支持免费和付费两种订阅等级。

详见 [配额系统技术文档](tech/quota-system.md)
```

---

### ❌ 反模式2：在tech/中写"为什么"

**错误示例**：
```markdown
## 为什么使用Neon HTTP Driver？

因为Cloudflare Workers不支持持久TCP连接...（省略大段解释）
```

**正确做法**：
```markdown
## 数据库连接

使用 Neon HTTP Driver 通过HTTP协议连接数据库：

```typescript
const db = drizzle(env.DATABASE_URL);
```

**注意**：无事务支持，需使用原子操作。
```

---

### ❌ 反模式3：在ops/中写架构设计

**错误示例**：
```markdown
## 部署前准备

首先需要理解系统架构，本系统采用前后端分离...（省略架构讲解）
```

**正确做法**：
```markdown
## 部署前准备

### 前置条件
- [ ] 已有Cloudflare账号
- [ ] 已创建Neon数据库
- [ ] 已配置Stripe密钥

### 步骤1：安装Wrangler CLI
```bash
npm install -g wrangler
```
...
```

---

## 🎓 总结

### 三层文档的核心价值

| 层级 | 读者 | 价值 | 时间成本 |
|------|------|------|----------|
| **心法** | 程序员 | 快速掌握全局 | 30分钟 |
| **大脑** | AI | 精准定位细节 | 1分钟 |
| **手册** | 操作者 | 可执行步骤 | 按需 |

### 记住这句话

> **"心法给脉络，大脑给细节，手册给步骤"**

### 遇到问题时

**问题**：不知道这个内容该写在哪？

**判断方法**：
- 如果是"是什么" → 心法层（PRD、README）
- 如果是"怎么做" → 大脑层（tech/）
- 如果是"照着做" → 手册层（ops/）

---

## 📧 反馈与改进

如果你觉得文档体系有可以改进的地方：

1. 在项目中创建 Issue
2. 标签选择 `documentation`
3. 描述具体问题和建议

---

**最后更新**：2026-01-05
**版本**：v1.0
**维护者**：项目团队

