# Wrangler é…ç½®æ–‡ä»¶è¯¦è§£

> `wrangler.jsonc` çš„ä½œç”¨ã€æ„ä¹‰å’Œå†å²  
> æ—¥æœŸï¼š2025-11-01

---

## ğŸ“‹ ç›®å½•

- [æ–‡ä»¶ç®€ä»‹](#æ–‡ä»¶ç®€ä»‹)
- [å†å²æ¼”è¿›](#å†å²æ¼”è¿›)
- [é…ç½®é¡¹è¯¦è§£](#é…ç½®é¡¹è¯¦è§£)
- [åœ¨é¡¹ç›®ä¸­çš„ä½œç”¨](#åœ¨é¡¹ç›®ä¸­çš„ä½œç”¨)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ–‡ä»¶ç®€ä»‹

### ğŸ¯ ä»€ä¹ˆæ˜¯ wrangler.jsoncï¼Ÿ

`wrangler.jsonc` æ˜¯ **Cloudflare Workers çš„é…ç½®æ–‡ä»¶**ï¼Œç”¨äºå®šä¹‰ Worker çš„åç§°ã€å…¥å£æ–‡ä»¶ã€å…¼å®¹æ€§æ—¥æœŸã€ç¯å¢ƒå˜é‡ç­‰ã€‚

### ğŸ“Œ æ ¸å¿ƒä½œç”¨

```
wrangler.jsonc
    â†“
å®šä¹‰ Worker çš„è¡Œä¸ºå’Œé…ç½®
    â†“
wrangler dev / deploy è¯»å–
    â†“
åˆ›å»ºæˆ–æ›´æ–° Cloudflare Workers
```

### ğŸ”§ æ–‡ä»¶æ ¼å¼

- **æ‰©å±•å**ï¼š`.jsonc`ï¼ˆJSON with Commentsï¼‰
- **æ”¯æŒ**ï¼šæ³¨é‡Š `//` å’Œ `/* */`
- **ä¼˜åŠ¿**ï¼šæ¯” JSON æ›´å‹å¥½ï¼Œå¯ä»¥æ·»åŠ è¯´æ˜æ³¨é‡Š

---

## å†å²æ¼”è¿›

### ğŸ“œ Wrangler é…ç½®æ–‡ä»¶çš„å‘å±•å†ç¨‹

#### 1. **æ—©æœŸç‰ˆæœ¬ï¼ˆWrangler 1.xï¼‰**

**é…ç½®æ–‡ä»¶ï¼š`wrangler.toml`**

```toml
# wrangler.toml
name = "my-worker"
type = "webpack"
account_id = "your-account-id"
zone_id = "your-zone-id"

[env.production]
name = "my-worker-prod"
```

**ç‰¹ç‚¹ï¼š**

- âœ… ä½¿ç”¨ TOML æ ¼å¼ï¼ˆæ›´æ˜“è¯»ï¼‰
- âœ… æ”¯æŒç¯å¢ƒé…ç½®
- âŒ é…ç½®é¡¹è¾ƒå°‘
- âŒ éœ€è¦æ‰‹åŠ¨é…ç½® account_id

---

#### 2. **è¿‡æ¸¡æœŸï¼ˆWrangler 2.xï¼‰**

**é…ç½®æ–‡ä»¶ï¼š`wrangler.toml` â†’ `wrangler.json`**

```json
// wrangler.json
{
  "name": "my-worker",
  "main": "src/index.ts",
  "compatibility_date": "2022-06-01"
}
```

**å˜åŒ–ï¼š**

- âœ… æ”¹ç”¨ JSON æ ¼å¼ï¼ˆæ›´æ ‡å‡†ï¼‰
- âœ… æ–°å¢ `compatibility_date`ï¼ˆå…¼å®¹æ€§æ—¥æœŸï¼‰
- âœ… è‡ªåŠ¨æ£€æµ‹ account_idï¼ˆæ— éœ€æ‰‹åŠ¨é…ç½®ï¼‰
- âœ… æ”¯æŒ TypeScript å…¥å£æ–‡ä»¶

---

#### 3. **ç°ä»£ç‰ˆæœ¬ï¼ˆWrangler 3.x+ï¼‰**

**é…ç½®æ–‡ä»¶ï¼š`wrangler.jsonc`** â­

```jsonc
// wrangler.jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "my-worker",
  "main": "src/index.ts",
  "compatibility_date": "2025-10-11",
  "dev": {
    "port": 3000
  }
}
```

**é‡å¤§å˜åŒ–ï¼š**

- âœ… **æ”¯æŒæ³¨é‡Š**ï¼š`.jsonc` æ ¼å¼å…è®¸æ³¨é‡Š
- âœ… **Schema æ”¯æŒ**ï¼š`$schema` æä¾›è‡ªåŠ¨è¡¥å…¨å’ŒéªŒè¯
- âœ… **æ›´ä¸°å¯Œçš„é…ç½®**ï¼šæ›´å¤šå¯é€‰é…ç½®é¡¹
- âœ… **ç±»å‹å®‰å…¨**ï¼šTypeScript é¡¹ç›®é›†æˆæ›´å¥½

---

### ğŸ• æ—¶é—´çº¿

| æ—¶é—´          | Wrangler ç‰ˆæœ¬ | é…ç½®æ–‡ä»¶         | ç‰¹ç‚¹                          |
| ------------- | ------------- | ---------------- | ----------------------------- |
| **2019-2021** | 1.x           | `wrangler.toml`  | TOML æ ¼å¼ï¼Œæ‰‹åŠ¨é…ç½®           |
| **2021-2022** | 2.x           | `wrangler.json`  | JSON æ ¼å¼ï¼Œè‡ªåŠ¨åŒ–             |
| **2023-è‡³ä»Š** | 3.x+          | `wrangler.jsonc` | JSONC æ ¼å¼ï¼Œæ”¯æŒæ³¨é‡Šå’Œ Schema |

---

### ğŸ’¡ ä¸ºä»€ä¹ˆæ”¹ç”¨ .jsoncï¼Ÿ

**é—®é¢˜ï¼šJSON ä¸æ”¯æŒæ³¨é‡Š**

```json
// âŒ JSON ä¸æ”¯æŒæ³¨é‡Š
{
  "name": "api",
  // "compatibility_flags": ["nodejs_compat"]  // âŒ ä¼šæŠ¥é”™
  "main": "src/index.ts"
}
```

**è§£å†³æ–¹æ¡ˆï¼šJSONC (JSON with Comments)**

```jsonc
// âœ… JSONC æ”¯æŒæ³¨é‡Š
{
  "name": "api",
  // "compatibility_flags": ["nodejs_compat"]  // âœ… å¯ä»¥æ³¨é‡Š
  "main": "src/index.ts"
}
```

**ä¼˜åŠ¿ï¼š**

- âœ… å¯ä»¥æ³¨é‡Šæ‰æš‚æ—¶ä¸ç”¨çš„é…ç½®
- âœ… å¯ä»¥æ·»åŠ è¯´æ˜æ€§æ³¨é‡Š
- âœ… æ›´å®¹æ˜“ç»´æŠ¤å’Œåä½œ

---

## é…ç½®é¡¹è¯¦è§£

### ğŸ“ å½“å‰é…ç½®æ–‡ä»¶è§£æ

è®©æˆ‘ä»¬é€è¡Œè§£é‡Š `wrangler.jsonc`ï¼š

```jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json",
  // â†‘ Schema è·¯å¾„ï¼šæä¾›è‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ£€æŸ¥ï¼ˆVSCodeï¼‰

  "name": "api",
  // â†‘ Worker åç§°ï¼šéƒ¨ç½²ååœ¨ Cloudflare Dashboard æ˜¾ç¤ºçš„åç§°
  //   è®¿é—® URLï¼šhttps://api.your-subdomain.workers.dev

  "main": "src/index.ts",
  // â†‘ å…¥å£æ–‡ä»¶ï¼šWorker çš„å…¥å£ç‚¹
  //   å¿…é¡»å¯¼å‡º default { fetch: ... }

  "compatibility_date": "2025-10-11",
  // â†‘ å…¼å®¹æ€§æ—¥æœŸï¼šé”å®šè¿è¡Œæ—¶è¡Œä¸ºç‰ˆæœ¬
  //   é˜²æ­¢ Cloudflare æ›´æ–°ç ´åç°æœ‰ä»£ç 

  "dev": {
    "port": 3000
  }
  // â†‘ å¼€å‘æœåŠ¡å™¨é…ç½®ï¼šæœ¬åœ°å¼€å‘æ—¶çš„ç«¯å£
}
```

---

### ğŸ”§ æ‰€æœ‰é…ç½®é¡¹è¯´æ˜

#### åŸºç¡€é…ç½®

| é…ç½®é¡¹               | ç±»å‹   | å¿…éœ€ | è¯´æ˜                     |
| -------------------- | ------ | ---- | ------------------------ |
| `name`               | string | âœ…   | Worker åç§°              |
| `main`               | string | âœ…   | å…¥å£æ–‡ä»¶è·¯å¾„             |
| `compatibility_date` | string | âœ…   | å…¼å®¹æ€§æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ |

#### å¼€å‘é…ç½®

| é…ç½®é¡¹               | ç±»å‹    | è¯´æ˜                           |
| -------------------- | ------- | ------------------------------ |
| `dev.port`           | number  | æœ¬åœ°å¼€å‘ç«¯å£ï¼ˆé»˜è®¤ 8787ï¼‰      |
| `dev.ip`             | string  | ç»‘å®š IPï¼ˆé»˜è®¤ "127.0.0.1"ï¼‰    |
| `dev.local_protocol` | string  | åè®®ï¼ˆ"http" æˆ– "https"ï¼‰      |
| `dev.remote`         | boolean | æ˜¯å¦ä½¿ç”¨è¿œç¨‹å¼€å‘ï¼ˆé»˜è®¤ falseï¼‰ |
| `dev.upstream`       | string  | ä¸Šæ¸¸ä»£ç†åœ°å€ï¼ˆç”¨äºæµ‹è¯•ï¼‰       |

##### ğŸ› ï¸ dev.port - å¼€å‘ç«¯å£

**ä½œç”¨ï¼š** æŒ‡å®šæœ¬åœ°å¼€å‘æœåŠ¡å™¨çš„ç«¯å£

**é»˜è®¤å€¼ï¼š** `8787`

**ç¤ºä¾‹ï¼š**

```jsonc
{
  "dev": {
    "port": 3000 // æ”¹ä¸º 3000ï¼ˆä¸ Node.js ç»Ÿä¸€ï¼‰
  }
}
```

**è®¿é—®åœ°å€ï¼š**

```
http://localhost:3000  // ä½¿ç”¨è‡ªå®šä¹‰ç«¯å£
http://localhost:8787  // ä½¿ç”¨é»˜è®¤ç«¯å£
```

**ä¸ºä»€ä¹ˆä¿®æ”¹ï¼Ÿ**

- âœ… ä¸å…¶ä»–æœåŠ¡ç»Ÿä¸€ç«¯å£ï¼ˆå¦‚ Node.js ä¹Ÿç”¨ 3000ï¼‰
- âœ… é¿å…ç«¯å£å†²çª
- âœ… æ–¹ä¾¿å‰ç«¯é…ç½®ä»£ç†

##### ğŸŒ dev.ip - ç»‘å®š IP

**ä½œç”¨ï¼š** æŒ‡å®šå¼€å‘æœåŠ¡å™¨ç»‘å®šçš„ IP åœ°å€

**é»˜è®¤å€¼ï¼š** `"127.0.0.1"`ï¼ˆåªå…è®¸æœ¬åœ°è®¿é—®ï¼‰

**ç¤ºä¾‹ï¼š**

```jsonc
{
  "dev": {
    "ip": "0.0.0.0" // å…è®¸æ‰€æœ‰ç½‘ç»œæ¥å£è®¿é—®ï¼ˆå±€åŸŸç½‘å¯è®¿é—®ï¼‰
  }
}
```

**ä½¿ç”¨åœºæ™¯ï¼š**

| IP                | æ•ˆæœ           | ä½¿ç”¨åœºæ™¯      |
| ----------------- | -------------- | ------------- |
| `"127.0.0.1"`     | ä»…æœ¬åœ°è®¿é—®     | âœ… é»˜è®¤ï¼Œå®‰å…¨ |
| `"0.0.0.0"`       | æ‰€æœ‰æ¥å£å¯è®¿é—® | å±€åŸŸç½‘æµ‹è¯•    |
| `"192.168.1.100"` | æŒ‡å®š IP        | ç‰¹å®šç½‘ç»œæ¥å£  |

##### ğŸ”’ dev.local_protocol - æœ¬åœ°åè®®

**ä½œç”¨ï¼š** æŒ‡å®šæœ¬åœ°å¼€å‘ä½¿ç”¨çš„åè®®

**é»˜è®¤å€¼ï¼š** `"http"`

**é€‰é¡¹ï¼š**

- `"http"` - HTTP åè®®ï¼ˆé»˜è®¤ï¼‰
- `"https"` - HTTPS åè®®ï¼ˆéœ€è¦è¯ä¹¦ï¼‰

**ç¤ºä¾‹ï¼š**

```jsonc
{
  "dev": {
    "local_protocol": "https" // ä½¿ç”¨ HTTPSï¼ˆéœ€è¦é…ç½®è¯ä¹¦ï¼‰
  }
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹ï¼š**

- HTTPS éœ€è¦é…ç½® SSL è¯ä¹¦ï¼ˆè‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨é…ç½®ï¼‰
- å¤§å¤šæ•°å¼€å‘åœºæ™¯ä½¿ç”¨ HTTP å³å¯

##### ğŸŒ dev.remote - è¿œç¨‹å¼€å‘

**ä½œç”¨ï¼š** æ˜¯å¦ä½¿ç”¨ Cloudflare çš„è¿œç¨‹å¼€å‘ç¯å¢ƒ

**é»˜è®¤å€¼ï¼š** `false`ï¼ˆæœ¬åœ°å¼€å‘ï¼‰

**ç¤ºä¾‹ï¼š**

```jsonc
{
  "dev": {
    "remote": true // ä½¿ç”¨ Cloudflare è¿œç¨‹ç¯å¢ƒï¼ˆæ¥è¿‘ç”Ÿäº§ç¯å¢ƒï¼‰
  }
}
```

**åŒºåˆ«ï¼š**

| æ¨¡å¼            | è¿è¡Œä½ç½®        | é€Ÿåº¦ | çœŸå®æ€§               |
| --------------- | --------------- | ---- | -------------------- |
| `remote: false` | æœ¬åœ°æœºå™¨        | å¿«   | å¯èƒ½ä¸ç”Ÿäº§ç¯å¢ƒæœ‰å·®å¼‚ |
| `remote: true`  | Cloudflare è¾¹ç¼˜ | ç¨æ…¢ | âœ… æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ      |

**ä½¿ç”¨åœºæ™¯ï¼š**

- âœ… æµ‹è¯•ç”Ÿäº§ç¯å¢ƒè¡Œä¸º
- âœ… è°ƒè¯•è¾¹ç¼˜ç½‘ç»œé—®é¢˜
- âŒ æ—¥å¸¸å¼€å‘ï¼ˆæœ¬åœ°æ›´å¿«ï¼‰

##### ğŸ”„ dev.upstream - ä¸Šæ¸¸ä»£ç†

**ä½œç”¨ï¼š** å°†æœªåŒ¹é…çš„è¯·æ±‚ä»£ç†åˆ°ä¸Šæ¸¸æœåŠ¡å™¨

**ç¤ºä¾‹ï¼š**

```jsonc
{
  "dev": {
    "upstream": "http://localhost:3001" // æœªåŒ¹é…çš„è¯·æ±‚è½¬å‘åˆ° 3001
  }
}
```

**ä½¿ç”¨åœºæ™¯ï¼š**

- âœ… å¾®æœåŠ¡å¼€å‘ï¼ˆéƒ¨åˆ†è·¯ç”±åœ¨ Workerï¼Œéƒ¨åˆ†åœ¨å…¶ä»–æœåŠ¡ï¼‰
- âœ… æ··åˆæ¶æ„æµ‹è¯•
- âœ… API ç½‘å…³åœºæ™¯

#### å…¼å®¹æ€§é…ç½®

| é…ç½®é¡¹                | ç±»å‹     | è¯´æ˜                             |
| --------------------- | -------- | -------------------------------- |
| `compatibility_flags` | string[] | å…¼å®¹æ€§æ ‡å¿—ï¼ˆå¦‚ "nodejs_compat"ï¼‰ |
| `compatibility_date`  | string   | å…¼å®¹æ€§æ—¥æœŸ                       |

##### ğŸ” compatibility_date - å…¼å®¹æ€§æ—¥æœŸï¼ˆé‡è¦ï¼‰

**ä»€ä¹ˆæ˜¯å…¼å®¹æ€§æ—¥æœŸï¼Ÿ**

`compatibility_date` æ˜¯ Cloudflare Workers çš„**ç‰ˆæœ¬é”å®šæœºåˆ¶**ï¼Œç”¨äºæŒ‡å®šä»£ç åŸºäºå“ªä¸ªç‰ˆæœ¬çš„è¿è¡Œæ—¶è¡Œä¸ºç¼–å†™ã€‚

**ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ**

Cloudflare Workers è¿è¡Œæ—¶ä¸æ–­æ›´æ–°ï¼Œæœ‰æ—¶ä¼šå¼•å…¥**ç ´åæ€§å˜æ›´**ï¼ˆBreaking Changesï¼‰ã€‚å…¼å®¹æ€§æ—¥æœŸå¯ä»¥ï¼š

1. **é”å®šè¡Œä¸º**ï¼šç¡®ä¿ä»£ç å§‹ç»ˆåŸºäºç‰¹å®šç‰ˆæœ¬çš„è¿è¡Œæ—¶è¡Œä¸º
2. **é˜²æ­¢ç ´å**ï¼šé¿å… Cloudflare æ›´æ–°å¯¼è‡´ä»£ç æ„å¤–å¤±æ•ˆ
3. **å¯æ§å‡çº§**ï¼šæŒ‰è‡ªå·±çš„èŠ‚å¥å‡çº§ï¼Œè€Œä¸æ˜¯è¢«åŠ¨æ¥å—å˜æ›´

**å·¥ä½œåŸç†ï¼š**

```
è®¾ç½® compatibility_date: "2025-10-11"
    â†“
Cloudflare è¿è¡Œæ—¶ä½¿ç”¨ 2025-10-11 çš„è¡Œä¸ºç‰ˆæœ¬
    â†“
å³ä½¿ Cloudflare æœ‰æ›´æ–°ï¼Œä½ çš„ä»£ç ä»ç„¶æŒ‰æ—§ç‰ˆæœ¬è¡Œä¸ºè¿è¡Œ
    â†“
åªæœ‰ä½ ä¸»åŠ¨æ›´æ–°æ—¥æœŸï¼Œæ‰ä¼šä½¿ç”¨æ–°ç‰ˆæœ¬çš„è¡Œä¸º
```

**å¦‚ä½•é€‰æ‹©æ—¥æœŸï¼Ÿ**

```bash
# 1. æŸ¥çœ‹ wrangler æ”¯æŒçš„æœ€æ–°æ—¥æœŸ
wrangler --version
# wrangler 4.45.2
# Latest compatibility date: 2025-10-11

# 2. è®¾ç½®ä¸ºæ”¯æŒçš„æœ€æ–°æ—¥æœŸï¼ˆæ¨èï¼‰
{
  "compatibility_date": "2025-10-11"
}
```

**å¸¸è§åœºæ™¯ï¼š**

| åœºæ™¯         | å»ºè®®                     |
| ------------ | ------------------------ |
| **æ–°é¡¹ç›®**   | ä½¿ç”¨æœ€æ–°æ”¯æŒçš„æ—¥æœŸ       |
| **ç°æœ‰é¡¹ç›®** | ä¿æŒå½“å‰æ—¥æœŸï¼Œç¨³å®šè¿è¡Œ   |
| **å‡çº§æ—¶**   | é€æ­¥æ›´æ–°æ—¥æœŸï¼Œæµ‹è¯•åç»§ç»­ |

**æ³¨æ„äº‹é¡¹ï¼š**

- âš ï¸ **ä¸èƒ½è®¾ç½®æœªæ¥æ—¥æœŸ**ï¼šè¶…è¿‡æ”¯æŒçš„æ—¥æœŸä¼šè¢«å›é€€åˆ°æœ€æ–°æ”¯æŒæ—¥æœŸ
- âš ï¸ **æ—§æ—¥æœŸå¯èƒ½æœ‰å®‰å…¨æ¼æ´**ï¼šå»ºè®®å®šæœŸæ›´æ–°
- âœ… **æ ¼å¼å¿…é¡»æ­£ç¡®**ï¼š`YYYY-MM-DD`ï¼ˆå¦‚ `"2025-10-11"`ï¼‰

##### ğŸš© compatibility_flags - å…¼å®¹æ€§æ ‡å¿—

**ä½œç”¨ï¼š** å¯ç”¨ç‰¹å®šçš„å…¼å®¹æ€§ç‰¹æ€§

**å¸¸è§æ ‡å¿—ï¼š**

| æ ‡å¿—                            | è¯´æ˜                  | ä½¿ç”¨åœºæ™¯                            |
| ------------------------------- | --------------------- | ----------------------------------- |
| `"nodejs_compat"`               | å¯ç”¨ Node.js API å…¼å®¹ | éœ€è¦ä½¿ç”¨ Node.js APIï¼ˆå¦‚ `Buffer`ï¼‰ |
| `"webgpu"`                      | å¯ç”¨ WebGPU API       | éœ€è¦ GPU è®¡ç®—                       |
| `"streams_enable_constructors"` | å¯ç”¨æµæ„é€ å‡½æ•°        | éœ€è¦ä½¿ç”¨æµ API                      |

**ç¤ºä¾‹ï¼š**

```jsonc
{
  "compatibility_flags": ["nodejs_compat"]
  // ç°åœ¨å¯ä»¥ä½¿ç”¨ Node.js å…¼å®¹çš„ API
  // æ³¨æ„ï¼šä¼šç¨å¾®å¢åŠ  Worker ä½“ç§¯
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹ï¼š**

- æ¯ä¸ªæ ‡å¿—éƒ½ä¼šå¢åŠ  Worker çš„åŒ…ä½“ç§¯
- åªåœ¨ç¡®å®éœ€è¦æ—¶æ‰å¯ç”¨
- ä¼˜å…ˆä½¿ç”¨ Web æ ‡å‡† APIï¼Œé¿å…ä½¿ç”¨ Node.js API

#### ç¯å¢ƒå˜é‡

| é…ç½®é¡¹      | ç±»å‹   | è¯´æ˜                              |
| ----------- | ------ | --------------------------------- |
| `vars`      | object | ç¯å¢ƒå˜é‡ï¼ˆé”®å€¼å¯¹ï¼‰                |
| `.dev.vars` | file   | å¼€å‘ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼ˆä¸åœ¨ jsonc ä¸­ï¼‰ |

##### ğŸ”‘ vars - ç¯å¢ƒå˜é‡é…ç½®

**ä½œç”¨ï¼š** åœ¨ `wrangler.jsonc` ä¸­ç›´æ¥å®šä¹‰ç¯å¢ƒå˜é‡

**æ ¼å¼ï¼š**

```jsonc
{
  "vars": {
    "ENVIRONMENT": "production",
    "API_VERSION": "v1",
    "FEATURE_FLAG_X": "enabled"
  }
}
```

**ä½¿ç”¨åœºæ™¯ï¼š**

- âœ… **éæ•æ„Ÿä¿¡æ¯**ï¼šå…¬å…±é…ç½®ã€ç‰ˆæœ¬å·ã€åŠŸèƒ½å¼€å…³
- âŒ **æ•æ„Ÿä¿¡æ¯**ï¼šå¯†ç ã€å¯†é’¥ã€æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²

**è®¿é—®æ–¹å¼ï¼š**

```typescript
// åœ¨ Worker ä»£ç ä¸­è®¿é—®
export default {
  fetch(request, env) {
    console.log(env.ENVIRONMENT); // "production"
    console.log(env.API_VERSION); // "v1"
    return new Response("OK");
  },
};
```

**âš ï¸ å®‰å…¨æç¤ºï¼š**

```jsonc
// âŒ ä¸è¦è¿™æ ·åšï¼
{
  "vars": {
    "DATABASE_URL": "postgresql://user:password@host/db", // å¯†ç æ³„éœ²ï¼
    "SECRET_KEY": "my-secret-key" // å¯†é’¥æ³„éœ²ï¼
  }
}
```

**æ­£ç¡®åšæ³•ï¼š**

```bash
# âœ… æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ .dev.varsï¼ˆå¼€å‘ï¼‰æˆ– Dashboardï¼ˆç”Ÿäº§ï¼‰
# .dev.varsï¼ˆæœ¬åœ°å¼€å‘ï¼‰
DATABASE_URL=postgresql://...
SECRET_KEY=xxx

# ç”Ÿäº§ç¯å¢ƒï¼šCloudflare Dashboard â†’ Settings â†’ Environment Variables
```

##### ğŸ“„ .dev.vars - å¼€å‘ç¯å¢ƒå˜é‡æ–‡ä»¶

**ä½œç”¨ï¼š** æœ¬åœ°å¼€å‘æ—¶çš„ç¯å¢ƒå˜é‡é…ç½®ï¼ˆä¸ä¼šè¢«éƒ¨ç½²ï¼‰

**æ–‡ä»¶ä½ç½®ï¼š** é¡¹ç›®æ ¹ç›®å½• `.dev.vars`

**æ ¼å¼ï¼š**

```bash
# .dev.vars
DATABASE_URL=postgresql://localhost:5432/mydb
BETTER_AUTH_SECRET=my-dev-secret-key
BETTER_AUTH_URL=http://localhost:3000
```

**ç‰¹ç‚¹ï¼š**

- âœ… ä»…ç”¨äºæœ¬åœ°å¼€å‘
- âœ… ä¸ä¼šè¢« git æäº¤ï¼ˆåº”è¯¥åœ¨ `.gitignore`` ä¸­ï¼‰
- âœ… è‡ªåŠ¨è¢« `wrangler dev` è¯»å–

**ä¸ `vars` çš„åŒºåˆ«ï¼š**

| é…ç½®æ–¹å¼    | ä½œç”¨åŸŸ   | æ˜¯å¦éƒ¨ç½² | ç”¨é€”         |
| ----------- | -------- | -------- | ------------ |
| `vars`      | ç”Ÿäº§ç¯å¢ƒ | âœ… æ˜¯    | éæ•æ„Ÿé…ç½®   |
| `.dev.vars` | å¼€å‘ç¯å¢ƒ | âŒ å¦    | æ‰€æœ‰ç¯å¢ƒå˜é‡ |

**æœ€ä½³å®è·µï¼š**

```bash
# .gitignore
.dev.vars  # ä¸æäº¤æ•æ„Ÿä¿¡æ¯

# .dev.vars.exampleï¼ˆæäº¤åˆ° gitï¼‰
DATABASE_URL=your-database-url
BETTER_AUTH_SECRET=your-secret-key
BETTER_AUTH_URL=http://localhost:3000
```

#### ç»‘å®šé…ç½®ï¼ˆé«˜çº§ï¼‰

| é…ç½®é¡¹            | ç±»å‹   | è¯´æ˜              |
| ----------------- | ------ | ----------------- |
| `kv_namespaces`   | array  | KV å­˜å‚¨å‘½åç©ºé—´   |
| `r2_buckets`      | array  | R2 å¯¹è±¡å­˜å‚¨æ¡¶     |
| `d1_databases`    | array  | D1 æ•°æ®åº“         |
| `durable_objects` | object | æŒä¹…åŒ–å¯¹è±¡        |
| `services`        | array  | å…¶ä»– Workers æœåŠ¡ |
| `ai`              | object | AI æ¨¡å‹ç»‘å®š       |

##### ğŸ’¾ kv_namespaces - KV å­˜å‚¨ç»‘å®š

**ä½œç”¨ï¼š** ç»‘å®š Cloudflare KVï¼ˆé”®å€¼å­˜å‚¨ï¼‰å‘½åç©ºé—´

**ä»€ä¹ˆæ˜¯ KVï¼Ÿ**

KV æ˜¯ Cloudflare æä¾›çš„**å…¨çƒåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨**ï¼Œé€‚åˆå­˜å‚¨ï¼š

- ç¼“å­˜æ•°æ®
- é…ç½®ä¿¡æ¯
- ç”¨æˆ·ä¼šè¯ï¼ˆå°æ•°æ®ï¼‰

**é…ç½®ç¤ºä¾‹ï¼š**

```jsonc
{
  "kv_namespaces": [
    {
      "binding": "CACHE", // åœ¨ä»£ç ä¸­çš„å˜é‡å
      "id": "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx", // KV å‘½åç©ºé—´ ID
      "preview_id": "yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy" // é¢„è§ˆç¯å¢ƒ IDï¼ˆå¯é€‰ï¼‰
    }
  ]
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**

```typescript
export default {
  async fetch(request, env) {
    // è¯»å–
    const value = await env.CACHE.get("key");

    // å†™å…¥
    await env.CACHE.put("key", "value", { expirationTtl: 3600 });

    return new Response(value);
  },
};
```

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… ç¼“å­˜ API å“åº”
- âœ… å­˜å‚¨ç”¨æˆ·ä¼šè¯
- âœ… å­˜å‚¨é…ç½®æ•°æ®
- âŒ ä¸é€‚åˆå¤§é‡æ•°æ®ï¼ˆæ¯æ¡é™åˆ¶ 25MBï¼‰

##### ğŸ“¦ r2_buckets - R2 å­˜å‚¨æ¡¶ç»‘å®š

**ä½œç”¨ï¼š** ç»‘å®š Cloudflare R2ï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰å­˜å‚¨æ¡¶

**ä»€ä¹ˆæ˜¯ R2ï¼Ÿ**

R2 æ˜¯ Cloudflare æä¾›çš„**S3 å…¼å®¹çš„å¯¹è±¡å­˜å‚¨**ï¼Œç±»ä¼¼äº AWS S3ã€‚

**é…ç½®ç¤ºä¾‹ï¼š**

```jsonc
{
  "r2_buckets": [
    {
      "binding": "UPLOADS", // åœ¨ä»£ç ä¸­çš„å˜é‡å
      "bucket_name": "my-uploads" // R2 å­˜å‚¨æ¡¶åç§°
    }
  ]
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**

```typescript
export default {
  async fetch(request, env) {
    // ä¸Šä¼ æ–‡ä»¶
    await env.UPLOADS.put("file.jpg", fileData);

    // ä¸‹è½½æ–‡ä»¶
    const object = await env.UPLOADS.get("file.jpg");

    return new Response(object.body);
  },
};
```

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- âœ… é™æ€èµ„æºå­˜å‚¨
- âœ… å›¾ç‰‡ã€è§†é¢‘ç­‰åª’ä½“æ–‡ä»¶
- âœ… å¤‡ä»½æ•°æ®

##### ğŸ—„ï¸ d1_databases - D1 æ•°æ®åº“ç»‘å®š

**ä½œç”¨ï¼š** ç»‘å®š Cloudflare D1ï¼ˆSQLite æ•°æ®åº“ï¼‰

**ä»€ä¹ˆæ˜¯ D1ï¼Ÿ**

D1 æ˜¯ Cloudflare æä¾›çš„**SQLite å…¼å®¹çš„æ•°æ®åº“**ï¼ŒåŸºäº SQLite æ„å»ºã€‚

**é…ç½®ç¤ºä¾‹ï¼š**

```jsonc
{
  "d1_databases": [
    {
      "binding": "DB", // åœ¨ä»£ç ä¸­çš„å˜é‡å
      "database_name": "my-database", // D1 æ•°æ®åº“åç§°
      "database_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" // æ•°æ®åº“ ID
    }
  ]
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**

```typescript
export default {
  async fetch(request, env) {
    // æ‰§è¡Œ SQL æŸ¥è¯¢
    const result = await env.DB.prepare("SELECT * FROM users WHERE id = ?")
      .bind(1)
      .first();

    return Response.json(result);
  },
};
```

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… éœ€è¦ SQL æ•°æ®åº“ä½†ä¸ä¾èµ– PostgreSQL
- âœ… å°å‹åº”ç”¨çš„æ•°æ®å­˜å‚¨
- âœ… è¾¹ç¼˜æ•°æ®åº“éœ€æ±‚
- âŒ ä¸é€‚åˆå¤æ‚æŸ¥è¯¢å’Œé«˜å¹¶å‘

**âš ï¸ æ³¨æ„ï¼š** å½“å‰é¡¹ç›®ä½¿ç”¨ Neonï¼ˆPostgreSQLï¼‰ï¼Œä¸éœ€è¦ D1ã€‚

##### ğŸ”„ durable_objects - æŒä¹…åŒ–å¯¹è±¡

**ä½œç”¨ï¼š** ç»‘å®š Durable Objectsï¼ˆæœ‰çŠ¶æ€çš„ Workerï¼‰

**ä»€ä¹ˆæ˜¯ Durable Objectsï¼Ÿ**

Durable Objects æ˜¯**æœ‰çŠ¶æ€çš„ã€å…¨çƒå”¯ä¸€çš„å¯¹è±¡**ï¼Œç¡®ä¿åŒä¸€ä¸ªå¯¹è±¡åªåœ¨ä¸€ä¸ªåœ°æ–¹è¿è¡Œã€‚

**é…ç½®ç¤ºä¾‹ï¼š**

```jsonc
{
  "durable_objects": {
    "bindings": [
      {
        "name": "COUNTER", // åœ¨ä»£ç ä¸­çš„å˜é‡å
        "class_name": "Counter", // Durable Object ç±»å
        "script_name": "worker" // åŒ…å«ç±»çš„ Worker åç§°
      }
    ]
  }
}
```

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… å®æ—¶åä½œï¼ˆå¦‚ WebSocketï¼‰
- âœ… éœ€è¦çŠ¶æ€åŒæ­¥çš„åº”ç”¨
- âœ… æ¸¸æˆæœåŠ¡å™¨
- âœ… åˆ†å¸ƒå¼é”

**âš ï¸ å¤æ‚åº¦è¾ƒé«˜ï¼Œä¸€èˆ¬é¡¹ç›®ä¸éœ€è¦ã€‚**

##### ğŸ”— services - å…¶ä»– Workers ç»‘å®š

**ä½œç”¨ï¼š** ç»‘å®šå…¶ä»– Cloudflare Workers æœåŠ¡

**é…ç½®ç¤ºä¾‹ï¼š**

```jsonc
{
  "services": [
    {
      "binding": "AUTH_SERVICE", // åœ¨ä»£ç ä¸­çš„å˜é‡å
      "service": "auth-worker", // ç›®æ ‡ Worker åç§°
      "environment": "production" // ç¯å¢ƒåç§°ï¼ˆå¯é€‰ï¼‰
    }
  ]
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**

```typescript
export default {
  async fetch(request, env) {
    // è°ƒç”¨å…¶ä»– Worker
    const response = await env.AUTH_SERVICE.fetch(request);
    return response;
  },
};
```

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… å¾®æœåŠ¡æ¶æ„
- âœ… Worker é—´é€šä¿¡
- âœ… æœåŠ¡æ‹†åˆ†

##### ğŸ¤– ai - AI æ¨¡å‹ç»‘å®š

**ä½œç”¨ï¼š** ç»‘å®š Cloudflare AI æ¨¡å‹ï¼ˆå¦‚ Workers AIï¼‰

**é…ç½®ç¤ºä¾‹ï¼š**

```jsonc
{
  "ai": {
    "binding": "AI" // åœ¨ä»£ç ä¸­çš„å˜é‡å
  }
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**

```typescript
export default {
  async fetch(request, env) {
    // ä½¿ç”¨ AI æ¨¡å‹
    const response = await env.AI.run("@cf/meta/llama-2-7b-chat-int8", {
      messages: [{ role: "user", content: "Hello!" }],
    });

    return Response.json(response);
  },
};
```

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… AI æ–‡æœ¬ç”Ÿæˆ
- âœ… AI å›¾åƒå¤„ç†
- âœ… è‡ªç„¶è¯­è¨€å¤„ç†
- âœ… æœºå™¨å­¦ä¹ æ¨ç†

##### ğŸ“Š observability - å¯è§‚æµ‹æ€§é…ç½®

**ä½œç”¨ï¼š** é…ç½®æ—¥å¿—å’Œç›‘æ§

**é…ç½®ç¤ºä¾‹ï¼š**

```jsonc
{
  "observability": {
    "enabled": true, // å¯ç”¨å¯è§‚æµ‹æ€§
    "head_sampling_rate": 1, // é‡‡æ ·ç‡ï¼ˆ0-1ï¼‰
    "tail_sampling_rate": 1, // å°¾éƒ¨é‡‡æ ·ç‡
    "logs": {
      "enabled": true, // å¯ç”¨æ—¥å¿—
      "level": "info" // æ—¥å¿—çº§åˆ«
    },
    "metrics": {
      "enabled": true, // å¯ç”¨æŒ‡æ ‡
      "custom_metrics_enabled": true // å¯ç”¨è‡ªå®šä¹‰æŒ‡æ ‡
    }
  }
}
```

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… ç”Ÿäº§ç¯å¢ƒç›‘æ§
- âœ… æ€§èƒ½åˆ†æ
- âœ… é”™è¯¯è¿½è¸ª
- âœ… æ—¥å¿—æ”¶é›†

**âš ï¸ æ³¨æ„ï¼š** ä¼šäº§ç”Ÿé¢å¤–è´¹ç”¨ï¼ˆåŸºäºä½¿ç”¨é‡ï¼‰

---

## åœ¨é¡¹ç›®ä¸­çš„ä½œç”¨

### ğŸ¯ å½“å‰é¡¹ç›®é…ç½®

```jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "api",
  "main": "src/index.ts",
  "compatibility_date": "2025-10-11",
  "dev": {
    "port": 3000
  }
}
```

#### é…ç½®è§£è¯»

1. **`name: "api"`**

   - Worker åç§°ï¼š`api`
   - éƒ¨ç½²åè®¿é—®ï¼š`https://api.your-subdomain.workers.dev`

2. **`main: "src/index.ts"`**

   - å…¥å£æ–‡ä»¶ï¼šæŒ‡å‘æˆ‘ä»¬ç®€åŒ–åçš„å•å…¥å£æ–‡ä»¶
   - ä¹‹å‰å¯èƒ½æ˜¯ `src/index.cf.ts`ï¼ˆåŒå…¥å£æ—¶ä»£ï¼‰

3. **`compatibility_date: "2025-10-11"`**

   - é”å®šè¿è¡Œæ—¶è¡Œä¸ºåˆ° 2025-10-11
   - é˜²æ­¢ Cloudflare æ›´æ–°ç ´åä»£ç 

4. **`dev.port: 3000`**
   - æœ¬åœ°å¼€å‘ç«¯å£ï¼š3000ï¼ˆä½ ä¿®æ”¹è¿‡çš„ï¼‰
   - é»˜è®¤æ˜¯ 8787

---

### ğŸ”„ ä¸é¡¹ç›®æ¶æ„çš„å…³ç³»

```
wrangler.jsonc
    â†“ å®šä¹‰é…ç½®
wrangler dev
    â†“ è¯»å–é…ç½®
å¯åŠ¨å¼€å‘æœåŠ¡å™¨
    â†“ è¿è¡Œ
src/index.ts
    â†“ å¯¼å…¥
ä¸­é—´ä»¶å’Œè·¯ç”±
    â†“ ä½¿ç”¨
æ•°æ®åº“å’Œè®¤è¯
```

---

### ğŸ“Š é…ç½®å˜æ›´å†å²ï¼ˆæœ¬é¡¹ç›®ï¼‰

| é˜¶æ®µ       | é…ç½®                      | åŸå›                         |
| ---------- | ------------------------- | --------------------------- |
| **åˆå§‹**   | `main: "src/index.ts"`    | å•å…¥å£ï¼ŒåŒ…å« Node.js ä»£ç    |
| **åŒå…¥å£** | `main: "src/index.cf.ts"` | åˆ†ç¦» Cloudflare å’Œ Node.js  |
| **ç®€åŒ–å** | `main: "src/index.ts"`    | å›åˆ°å•å…¥å£ï¼ˆçº¯ Cloudflareï¼‰ |

**ç°åœ¨ï¼š** ç®€æ´çš„å•å…¥å£é…ç½® âœ…

---

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

#### 1. ä½¿ç”¨ Schema

```jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json"
}
```

**å¥½å¤„ï¼š**

- âœ… VSCode è‡ªåŠ¨è¡¥å…¨
- âœ… ç±»å‹æ£€æŸ¥
- âœ… é…ç½®éªŒè¯

---

#### 2. åˆç†è®¾ç½®å…¼å®¹æ€§æ—¥æœŸ

```jsonc
{
  "compatibility_date": "2025-10-11" // ä½¿ç”¨ wrangler æ”¯æŒçš„æœ€æ–°æ—¥æœŸ
}
```

**å¦‚ä½•æŸ¥æ‰¾æœ€æ–°æ—¥æœŸï¼Ÿ**

```bash
wrangler --version
# wrangler 4.45.2
# Latest compatibility date: 2025-10-11
```

---

#### 3. ä½¿ç”¨æ³¨é‡Šè¯´æ˜é…ç½®

```jsonc
{
  "name": "api",
  // "compatibility_flags": ["nodejs_compat"],  // å¦‚éœ€ Node.js å…¼å®¹
  "main": "src/index.ts"
}
```

**ä¼˜åŠ¿ï¼š**

- âœ… ä¿ç•™é…ç½®ä½†ä¸å¯ç”¨
- âœ… æ·»åŠ è¯´æ˜æ€§æ³¨é‡Š

---

#### 4. ç¯å¢ƒå˜é‡åˆ†ç¦»

**å¼€å‘ç¯å¢ƒï¼š** `.dev.vars` æ–‡ä»¶

```bash
# .dev.vars
DATABASE_URL=postgresql://...
BETTER_AUTH_SECRET=xxx
```

**ç”Ÿäº§ç¯å¢ƒï¼š** Cloudflare Dashboard

- Settings â†’ Environment Variables

**ä¸åœ¨ `wrangler.jsonc` ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯ï¼**

---

### âš ï¸ å¸¸è§é”™è¯¯

#### é”™è¯¯ 1ï¼šç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯

```jsonc
// âŒ ä¸è¦è¿™æ ·åš
{
  "vars": {
    "DATABASE_URL": "postgresql://user:password@host/db" // æ³„éœ²å¯†ç 
  }
}
```

**æ­£ç¡®åšæ³•ï¼š**

```bash
# âœ… ä½¿ç”¨ .dev.vars æ–‡ä»¶
DATABASE_URL=postgresql://...
```

---

#### é”™è¯¯ 2ï¼šå…¼å®¹æ€§æ—¥æœŸè¿‡æ–°

```jsonc
// âŒ æ—¥æœŸè¶…è¿‡ wrangler æ”¯æŒèŒƒå›´
{
  "compatibility_date": "2030-01-01" // å¤ªæ–°ï¼Œä¼šå›é€€åˆ°æœ€æ–°æ”¯æŒçš„æ—¥æœŸ
}
```

**æ­£ç¡®åšæ³•ï¼š**

```bash
# âœ… æŸ¥çœ‹æ”¯æŒçš„æ—¥æœŸ
wrangler --version
# è®¾ç½®ä¸ºæ”¯æŒçš„æœ€æ–°æ—¥æœŸ
{
  "compatibility_date": "2025-10-11"
}
```

---

#### é”™è¯¯ 3ï¼šå…¥å£æ–‡ä»¶è·¯å¾„é”™è¯¯

```jsonc
// âŒ è·¯å¾„ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯
{
  "main": "dist/index.js" // å¦‚æœä½¿ç”¨ TypeScriptï¼Œåº”è¯¥æŒ‡å‘æºæ–‡ä»¶
}
```

**æ­£ç¡®åšæ³•ï¼š**

```jsonc
// âœ… æŒ‡å‘ TypeScript æºæ–‡ä»¶ï¼ˆwrangler ä¼šè‡ªåŠ¨ç¼–è¯‘ï¼‰
{
  "main": "src/index.ts"
}
```

---

## å®Œæ•´é…ç½®ç¤ºä¾‹

### ğŸš€ åŸºç¡€é…ç½®ï¼ˆå½“å‰é¡¹ç›®ï¼‰

```jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "api",
  "main": "src/index.ts",
  "compatibility_date": "2025-10-11",
  "dev": {
    "port": 3000
  }
}
```

---

### ğŸŒŸ é«˜çº§é…ç½®ï¼ˆå®Œæ•´ç¤ºä¾‹ï¼‰

```jsonc
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "api",
  "main": "src/index.ts",
  "compatibility_date": "2025-10-11",

  // å¼€å‘é…ç½®
  "dev": {
    "port": 3000,
    "ip": "127.0.0.1",
    "local_protocol": "http"
  },

  // å…¼å®¹æ€§æ ‡å¿—ï¼ˆå¦‚éœ€ Node.js API å…¼å®¹ï¼‰
  // "compatibility_flags": ["nodejs_compat"],

  // ç¯å¢ƒå˜é‡ï¼ˆä»…éæ•æ„Ÿä¿¡æ¯ï¼‰
  "vars": {
    "ENVIRONMENT": "production"
  }

  // KV å­˜å‚¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
  // "kv_namespaces": [
  //   {
  //     "binding": "CACHE",
  //     "id": "your-kv-namespace-id"
  //   }
  // ],

  // R2 å­˜å‚¨æ¡¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
  // "r2_buckets": [
  //   {
  //     "binding": "UPLOADS",
  //     "bucket_name": "my-bucket"
  //   }
  // ],

  // D1 æ•°æ®åº“ï¼ˆå¦‚æœéœ€è¦ï¼‰
  // "d1_databases": [
  //   {
  //     "binding": "DB",
  //     "database_name": "my-database",
  //     "database_id": "your-database-id"
  //   }
  // ]
}
```

---

## ç›¸å…³æ–‡ä»¶

### ğŸ“ é…ç½®æ–‡ä»¶å…³ç³»

```
wrangler.jsonc          â†’ æ ¸å¿ƒé…ç½®ï¼ˆWorker å®šä¹‰ï¼‰
    â†“
.dev.vars              â†’ å¼€å‘ç¯å¢ƒå˜é‡ï¼ˆæœ¬åœ°ï¼‰
    â†“
src/index.ts           â†’ å…¥å£æ–‡ä»¶ï¼ˆä¸šåŠ¡ä»£ç ï¼‰
    â†“
package.json           â†’ npm è„šæœ¬ï¼ˆ"dev": "wrangler dev"ï¼‰
```

### ğŸ”— ç›¸å…³æ–‡æ¡£

- **ARCHITECTURE.md** - æ•´ä½“æ¶æ„è®¾è®¡
- **DEPLOYMENT_GUIDE.md** - éƒ¨ç½²æŒ‡å—
- æœ¬æ–‡æ¡£ - Wrangler é…ç½®è¯¦è§£

---

## æ€»ç»“

### ğŸ¯ æ ¸å¿ƒè¦ç‚¹

1. **æ–‡ä»¶ä½œç”¨**ï¼šå®šä¹‰ Cloudflare Worker çš„é…ç½®å’Œè¡Œä¸º
2. **å†å²æ¼”è¿›**ï¼š`wrangler.toml` â†’ `wrangler.json` â†’ `wrangler.jsonc`
3. **å½“å‰æ ¼å¼**ï¼š`.jsonc` æ”¯æŒæ³¨é‡Šï¼Œæ›´å‹å¥½
4. **é¡¹ç›®è§’è‰²**ï¼šæŒ‡å®šå…¥å£æ–‡ä»¶ã€Worker åç§°ã€å…¼å®¹æ€§ç­‰

### ğŸ“Œ å…³é”®é…ç½®

| é…ç½®é¡¹               | ä½œç”¨           | å½“å‰å€¼           |
| -------------------- | -------------- | ---------------- |
| `name`               | Worker åç§°    | `"api"`          |
| `main`               | å…¥å£æ–‡ä»¶       | `"src/index.ts"` |
| `compatibility_date` | é”å®šè¿è¡Œæ—¶ç‰ˆæœ¬ | `"2025-10-11"`   |
| `dev.port`           | æœ¬åœ°å¼€å‘ç«¯å£   | `3000`           |

### ğŸ’¡ è®¾è®¡åŸåˆ™

- âœ… ä½¿ç”¨ Schema è·å¾—è‡ªåŠ¨è¡¥å…¨
- âœ… æ³¨é‡Šæ‰ä¸ç”¨çš„é…ç½®
- âœ… æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ `.dev.vars`
- âœ… å®šæœŸæ›´æ–°å…¼å®¹æ€§æ—¥æœŸ

---

## ğŸš€ å¸¸ç”¨å‘½ä»¤

### å¼€å‘æ¨¡å¼

```bash
# å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
pnpm dev

# ç­‰åŒäº
wrangler dev

# è®¿é—®
# http://localhost:3000ï¼ˆæ ¹æ®é…ç½®çš„ç«¯å£ï¼‰
```

### éƒ¨ç½²

```bash
# éƒ¨ç½²åˆ° Cloudflare Workers
pnpm deploy

# ç­‰åŒäº
wrangler deploy --minify

# éƒ¨ç½²åè®¿é—®
# https://api.your-subdomain.workers.dev
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
wrangler tail

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—ï¼ˆæ ¼å¼åŒ–è¾“å‡ºï¼‰
wrangler tail --format pretty

# æŸ¥çœ‹ç‰¹å®š Worker çš„æ—¥å¿—
wrangler tail --name api
```

### æŸ¥çœ‹ç‰ˆæœ¬å’Œå…¼å®¹æ€§æ—¥æœŸ

```bash
# æŸ¥çœ‹ wrangler ç‰ˆæœ¬å’Œæ”¯æŒçš„å…¼å®¹æ€§æ—¥æœŸ
wrangler --version

# è¾“å‡ºç¤ºä¾‹ï¼š
# wrangler 4.45.2
# Latest compatibility date: 2025-10-11

# å‡çº§ wrangler
pnpm update wrangler
```

### ç¯å¢ƒå˜é‡ç®¡ç†

```bash
# æŸ¥çœ‹æœ¬åœ°ç¯å¢ƒå˜é‡ï¼ˆ.dev.varsï¼‰
cat .dev.vars

# ç”Ÿäº§ç¯å¢ƒå˜é‡éœ€è¦åœ¨ Cloudflare Dashboard é…ç½®
# Workers & Pages â†’ é€‰æ‹© Worker â†’ Settings â†’ Environment Variables
```

### ç±»å‹ç”Ÿæˆ

```bash
# ç”Ÿæˆ Cloudflare Bindings ç±»å‹å®šä¹‰
pnpm cf-typegen

# ç­‰åŒäº
wrangler types --env-interface CloudflareBindings

# ç”Ÿæˆçš„æ–‡ä»¶ï¼šworker-configuration.d.ts
```

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

### ğŸ“‹ é…ç½®æ–‡ä»¶

```bash
# æŸ¥çœ‹å½“å‰é…ç½®
cat wrangler.jsonc

# ç¼–è¾‘é…ç½®
code wrangler.jsonc  # æˆ–ä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨
```

### ğŸ”§ å¼€å‘å·¥ä½œæµ

```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# 2. åœ¨å¦ä¸€ä¸ªç»ˆç«¯æŸ¥çœ‹æ—¥å¿—
wrangler tail

# 3. ä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡æ–°åŠ è½½ï¼ˆçƒ­æ›´æ–°ï¼‰
```

### ğŸš€ éƒ¨ç½²å·¥ä½œæµ

```bash
# 1. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
pnpm deploy

# 2. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
# Cloudflare Dashboard â†’ Workers & Pages â†’ é€‰æ‹© Worker

# 3. æŸ¥çœ‹ç”Ÿäº§æ—¥å¿—
wrangler tail --name api
```

### ğŸ› è°ƒè¯•æŠ€å·§

```bash
# ä½¿ç”¨è¿œç¨‹å¼€å‘æ¨¡å¼ï¼ˆæ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒï¼‰
wrangler dev --remote

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
wrangler dev --log-level debug

# æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
wrangler dev --dry-run
```

---

## ğŸ“š å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£

- [Wrangler é…ç½®æ–‡æ¡£](https://developers.cloudflare.com/workers/wrangler/configuration/)
- [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)
- [å…¼å®¹æ€§æ—¥æœŸè¯´æ˜](https://developers.cloudflare.com/workers/configuration/compatibility-dates/)
- [Wrangler CLI å‘½ä»¤](https://developers.cloudflare.com/workers/wrangler/commands/)

### æœ¬åœ°èµ„æº

```bash
# æŸ¥çœ‹ Schema æ–‡ä»¶ï¼ˆè‡ªåŠ¨è¡¥å…¨å’ŒéªŒè¯ï¼‰
cat node_modules/wrangler/config-schema.json

# æŸ¥çœ‹ Wrangler å¸®åŠ©
wrangler --help

# æŸ¥çœ‹ç‰¹å®šå‘½ä»¤å¸®åŠ©
wrangler dev --help
wrangler deploy --help
```

---

## âœ… æ€»ç»“

### ğŸ¯ æ ¸å¿ƒè¦ç‚¹

1. **æ–‡ä»¶ä½œç”¨**ï¼šå®šä¹‰ Cloudflare Worker çš„é…ç½®å’Œè¡Œä¸º
2. **å†å²æ¼”è¿›**ï¼š`wrangler.toml` â†’ `wrangler.json` â†’ `wrangler.jsonc`
3. **å½“å‰æ ¼å¼**ï¼š`.jsonc` æ”¯æŒæ³¨é‡Šï¼Œæ›´å‹å¥½
4. **é¡¹ç›®è§’è‰²**ï¼šæŒ‡å®šå…¥å£æ–‡ä»¶ã€Worker åç§°ã€å…¼å®¹æ€§ç­‰

### ğŸ“Œ å…³é”®é…ç½®

| é…ç½®é¡¹               | ä½œç”¨           | å½“å‰å€¼           |
| -------------------- | -------------- | ---------------- |
| `name`               | Worker åç§°    | `"api"`          |
| `main`               | å…¥å£æ–‡ä»¶       | `"src/index.ts"` |
| `compatibility_date` | é”å®šè¿è¡Œæ—¶ç‰ˆæœ¬ | `"2025-10-11"`   |
| `dev.port`           | æœ¬åœ°å¼€å‘ç«¯å£   | `3000`           |

### ğŸ’¡ è®¾è®¡åŸåˆ™

- âœ… ä½¿ç”¨ Schema è·å¾—è‡ªåŠ¨è¡¥å…¨
- âœ… æ³¨é‡Šæ‰ä¸ç”¨çš„é…ç½®
- âœ… æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ `.dev.vars`
- âœ… å®šæœŸæ›´æ–°å…¼å®¹æ€§æ—¥æœŸ

### ğŸ”‘ å¿«é€Ÿæ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š

- [ ] `compatibility_date` å·²è®¾ç½®ä¸ºæ”¯æŒçš„æœ€æ–°æ—¥æœŸ
- [ ] `main` æŒ‡å‘æ­£ç¡®çš„å…¥å£æ–‡ä»¶ï¼ˆ`src/index.ts`ï¼‰
- [ ] æ•æ„Ÿä¿¡æ¯å·²ä» `wrangler.jsonc` ç§»é™¤
- [ ] `.dev.vars` å·²æ·»åŠ åˆ° `.gitignore`
- [ ] ç”Ÿäº§ç¯å¢ƒå˜é‡å·²åœ¨ Cloudflare Dashboard é…ç½®

---

**è¿™å°±æ˜¯ `wrangler.jsonc` çš„å®Œæ•´æ•…äº‹ï¼** ğŸ“š

åŒ…å«äº†ä»å†å²æ¼”è¿›åˆ°è¯¦ç»†é…ç½®ï¼Œä»æœ€ä½³å®è·µåˆ°å¸¸ç”¨å‘½ä»¤çš„å…¨éƒ¨å†…å®¹ã€‚
