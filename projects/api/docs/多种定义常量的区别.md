# æšä¸¾å®šä¹‰æ–¹å¼è¯´æ˜

> **ğŸ“Œ é¡¹ç›®æ›´æ–°è¯´æ˜ï¼ˆ2025-01-15ï¼‰**ï¼š
> - æœ¬é¡¹ç›®å·²ç»Ÿä¸€ä½¿ç”¨ `pgEnum` å®šä¹‰æ‰€æœ‰æšä¸¾ç±»å‹
> - åŸæœ‰çš„ TypeScript å¸¸é‡å¯¹è±¡æ¨¡å¼ï¼ˆå¦‚ `const UserStatus = { ... } as const`ï¼‰å·²è¢«ç§»é™¤
> - åŸå› ï¼šæœªè¢«å®é™…ä½¿ç”¨ã€å†—ä½™ã€ç»´æŠ¤æˆæœ¬é«˜
> - æœ¬æ–‡æ¡£ä¿ç•™æŠ€æœ¯å¯¹æ¯”è¯´æ˜ä½œä¸ºå‚è€ƒ

---

## 1. TypeScript å¸¸é‡å¯¹è±¡æ¨¡å¼ï¼ˆå·²åºŸå¼ƒï¼‰

### 1.1 å…³äº `UserStatus` å¸¸é‡å¯¹è±¡

```typescript
export const UserStatus = {
  ACTIVE: "active",
  SUSPENDED: "suspended",
  DELETED: "deleted",
} as const;
```

**è¿™æ˜¯ TypeScript ä¸­çš„"å¯¹è±¡å¸¸é‡"æ¨¡å¼**ï¼Œä¸æ˜¯çœŸæ­£çš„æšä¸¾ï¼ˆTypeScript æœ‰ `enum` å…³é”®å­—ï¼‰ï¼Œä½†å®ƒèƒ½è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼š

- `as const` è®©å¯¹è±¡å˜æˆ**åªè¯»**ä¸”**å­—é¢é‡ç±»å‹**
- å¯ä»¥åƒæšä¸¾ä¸€æ ·ä½¿ç”¨ï¼š`UserStatus.ACTIVE` â†’ `"active"`
- ç›¸æ¯” TypeScript `enum`ï¼Œè¿™ç§æ–¹å¼æ›´è½»é‡ï¼Œç¼–è¯‘åå°±æ˜¯æ™®é€šå¯¹è±¡

## 2. å¸¸é‡å¯¹è±¡ vs ç±»å‹å®šä¹‰ï¼ˆåŒåï¼‰

```typescript
// è¿™æ˜¯ä¸€ä¸ªå€¼ï¼ˆvalueï¼‰- è¿è¡Œæ—¶å­˜åœ¨
export const UserStatus = { ... } as const;

// è¿™æ˜¯ä¸€ä¸ªç±»å‹ï¼ˆtypeï¼‰- ä»…åœ¨ç¼–è¯‘æ—¶å­˜åœ¨
export type UserStatus = (typeof UserStatus)[keyof typeof UserStatus];
```

**å®ƒä»¬åœ¨ä¸åŒçš„å‘½åç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥åŒåï¼š**

- **å€¼ç©ºé—´**ï¼š`const UserStatus` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶è®¿é—®ï¼Œå¦‚ `UserStatus.ACTIVE`
- **ç±»å‹ç©ºé—´**ï¼š`type UserStatus` æ˜¯ä¸€ä¸ªç±»å‹ï¼Œåªåœ¨ç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œè¡¨ç¤º `"active" | "suspended" | "deleted"`

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```typescript
// ä½¿ç”¨å€¼ï¼ˆè¿è¡Œæ—¶ï¼‰
const status = UserStatus.ACTIVE; // "active"

// ä½¿ç”¨ç±»å‹ï¼ˆç¼–è¯‘æ—¶ï¼‰
function setStatus(status: UserStatus) {
  // å‚æ•°ç±»å‹é™åˆ¶ä¸º "active" | "suspended" | "deleted"
  // ...
}
```

**ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ**

- æ—¢èƒ½åœ¨ä»£ç ä¸­å¼•ç”¨å¸¸é‡ï¼ˆé¿å…ç¡¬ç¼–ç å­—ç¬¦ä¸²ï¼‰
- åˆèƒ½è·å¾—ç±»å‹æ£€æŸ¥ï¼ˆTypeScript ä¼šéªŒè¯å€¼æ˜¯å¦åˆæ³•ï¼‰

## 2. æœ¬é¡¹ç›®çš„é€‰æ‹©ï¼šç»Ÿä¸€ä½¿ç”¨ `pgEnum`

### å½“å‰å®ç°ï¼š`pgEnum`ï¼ˆæ•°æ®åº“å±‚é¢ï¼‰

```typescript
// âœ… æœ¬é¡¹ç›®é‡‡ç”¨çš„æ–¹å¼
export const userStatusEnum = pgEnum("user_status", [
  "active",
  "suspended",
  "deleted",
]);

export const articleStatusEnum = pgEnum("article_status", [
  "pending",
  "analyzed",
  "archived",
]);

export const vocabularyLevelEnum = pgEnum("vocabulary_level", [
  "primary_school",
  "middle_school",
  "high_school",
  "cet4",
  "cet6",
  "ielts_toefl",
  "gre",
]);

// åœ¨è¡¨å®šä¹‰ä¸­ä½¿ç”¨
status: userStatusEnum("status").notNull().default("active");
level: vocabularyLevelEnum("vocabulary_level");
```

**ç‰¹ç‚¹ï¼š**

- âœ… åœ¨ **PostgreSQL æ•°æ®åº“** ä¸­åˆ›å»ºçœŸæ­£çš„ `ENUM` ç±»å‹
- âœ… æ•°æ®åº“å±‚é¢**å¼ºåˆ¶çº¦æŸ**ï¼Œåªèƒ½æ’å…¥å®šä¹‰çš„å€¼
- âœ… æ•°æ®å®Œæ•´æ€§æ›´å¼ºï¼Œé˜²æ­¢è„æ•°æ®
- âœ… Drizzle ORM è‡ªåŠ¨æ¨å¯¼å‡º TypeScript ç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨å®šä¹‰
- âš ï¸ ä¿®æ”¹æšä¸¾å€¼æ¯”è¾ƒéº»çƒ¦ï¼ˆéœ€è¦æ•°æ®åº“è¿ç§»ï¼‰
- âš ï¸ PostgreSQL ç‰¹æœ‰ï¼Œå¦‚æœæ¢æ•°æ®åº“éœ€è¦æ”¹åŠ¨

### ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¯¹è±¡æšä¸¾ï¼Ÿ

åœ¨æœ¬é¡¹ç›®æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œæ›¾åŒæ—¶å®šä¹‰äº†å¯¹è±¡æšä¸¾å’Œ `pgEnum`ï¼š

```typescript
// âŒ å·²ç§»é™¤ï¼šå†—ä½™å®šä¹‰
export const UserStatus = {
  ACTIVE: "active",
  SUSPENDED: "suspended",
  DELETED: "deleted",
} as const;

export type UserStatusType = (typeof UserStatus)[keyof typeof UserStatus];

// âœ… ä¿ç•™ï¼šå®é™…ä½¿ç”¨
export const userStatusEnum = pgEnum("user_status", [
  "active",
  "suspended",
  "deleted",
]);
```

**ç§»é™¤åŸå› ï¼š**

1. **æœªè¢«ä½¿ç”¨**ï¼šä»£ç åº“ä¸­æ²¡æœ‰ä»»ä½•åœ°æ–¹ä½¿ç”¨ `UserStatus.ACTIVE` æˆ– `UserStatusType`
2. **å†—ä½™**ï¼š`pgEnum` å·²ç»æä¾›äº†ç±»å‹æ¨å¯¼ï¼ŒDrizzle ORM è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹
3. **ç»´æŠ¤æˆæœ¬**ï¼šä¸¤å¤„å®šä¹‰éœ€è¦åŒæ­¥ç»´æŠ¤ï¼Œå®¹æ˜“å‡ºé”™
4. **æ•°æ®å®Œæ•´æ€§**ï¼š`pgEnum` çš„æ•°æ®åº“å±‚é¢çº¦æŸæ›´å¯é 

### è¿ç§»ç¤ºä¾‹

**æ·»åŠ æ–°æšä¸¾å€¼ï¼ˆéœ€è¦æ•°æ®åº“è¿ç§»ï¼‰ï¼š**

```typescript
// 1. ä¿®æ”¹ schema.ts
export const vocabularyLevelEnum = pgEnum("vocabulary_level", [
  "primary_school",
  "middle_school",
  "high_school",
  "cet4",
  "cet6",
  "ielts_toefl",
  "gre", // æ–°å¢
]);

// 2. ç”Ÿæˆè¿ç§»æ–‡ä»¶
// npm run db:generate

// 3. æ‰§è¡Œè¿ç§»
// npm run db:migrate
```

---

## 3. æ€»ç»“

**æœ¬é¡¹ç›®çš„è®¾è®¡å†³ç­–ï¼š**

- âœ… **ç»Ÿä¸€ä½¿ç”¨ `pgEnum`**ï¼šæ‰€æœ‰æšä¸¾ç±»å‹éƒ½ä½¿ç”¨ PostgreSQL ENUM
- âœ… **æ•°æ®åº“å±‚é¢çº¦æŸ**ï¼šé˜²æ­¢è„æ•°æ®ï¼Œæé«˜æ•°æ®å®Œæ•´æ€§
- âœ… **è‡ªåŠ¨ç±»å‹æ¨å¯¼**ï¼šDrizzle ORM è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤
- âœ… **å‡å°‘å†—ä½™**ï¼šåˆ é™¤æœªä½¿ç”¨çš„å¸¸é‡å¯¹è±¡å’Œç±»å‹å®šä¹‰

**é€‚ç”¨åœºæ™¯ï¼š**

- âœ… æœ¬é¡¹ç›®ç¡®å®šé•¿æœŸä½¿ç”¨ PostgreSQL
- âœ… æšä¸¾å€¼ç›¸å¯¹ç¨³å®šï¼Œä¸ä¼šé¢‘ç¹ä¿®æ”¹
- âœ… éœ€è¦å¼ºæ•°æ®å®Œæ•´æ€§ä¿è¯

**æƒè¡¡ï¼š**

- âš ï¸ ä¿®æ”¹æšä¸¾å€¼éœ€è¦æ•°æ®åº“è¿ç§»ï¼ˆå¯æ¥å—çš„ä»£ä»·ï¼‰
- âš ï¸ å¦‚æœæœªæ¥éœ€è¦åˆ‡æ¢æ•°æ®åº“ï¼Œéœ€è¦é‡æ„æšä¸¾å®šä¹‰ï¼ˆä½æ¦‚ç‡äº‹ä»¶ï¼‰
